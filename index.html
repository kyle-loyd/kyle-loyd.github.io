<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Python Terminal</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background-color: #1e1e1e;
      color: #c5c5c5;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .terminal {
      width: 80%;
      height: 70%;
      background-color: #000;
      border: 2px solid #555;
      padding: 10px;
      overflow-y: auto;
      box-shadow: 0px 0px 10px #000;
    }
    .terminal-input {
      display: flex;
      align-items: center;
    }
    .prompt {
      color: #00ff00;
      margin-right: 10px;
    }
    .input-area {
      flex: 1;
      color: #fff;
      background: none;
      border: none;
      outline: none;
      font-family: 'Courier New', monospace;
      font-size: 16px;
    }
    .output {
      white-space: pre-wrap;
      color: #fff;
      margin-bottom: 10px;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <div class="terminal" id="terminal">
    <div class="output">Welcome to the GitHub Python Terminal! Type 'ls', 'cd', or 'python' commands.</div>
    <div class="terminal-input">
      <span class="prompt">user@github:~$</span>
      <input class="input-area" id="input" type="text" autofocus />
    </div>
  </div>

  <script>
    async function main() {
      const pyodide = await loadPyodide();
      const terminal = document.getElementById("terminal");
      const input = document.getElementById("input");

      // Initialize state
      const baseURL = 'https://api.github.com/repos';
      const username = 'kyle-loyd'; 
      let currentRepo = null;
      let currentPath = '';

      async function fetchGitHubContents(repo, path) {
        try {
          let requestPath = `${baseURL}`
          if (!path){
            requestPath += `/users/${username}/repos`
          } else {
            requestPath += `/repos/${username}/{repo}/contents/{path}`
          }
          const response = await fetch(requestPath);
          if (!response.ok) throw new Error(`GitHub API Error: ${response.statusText}`);
          return await response.json();
        } catch (err) {
          return null;
        }
      }

      async function executeCommand(command) {
        const [cmd, ...args] = command.split(' ');

        switch (cmd) {
          case 'ls':
            if (!currentRepo) {
              return 'Available Repositories:\n- ' + (await fetchGitHubContents(null, null) || [])
                .map(repo => repo.name)
                .join('\n');
            } else {
              const path = args[0] || currentPath || '';
              const contents = await fetchGitHubContents(currentRepo, path);
              if (!contents) return `ls: cannot access '${path}': No such file or directory`;
              return contents.map(item => (item.type === 'dir' ? `[${item.name}]` : item.name)).join('\n');
            }

          case 'cd':
            if (!args[0]) return 'Usage: cd <repository or directory>';
            if (!currentRepo) {
              // Navigate to a repository
              currentRepo = args[0];
              return `Switched to repository: ${currentRepo}`;
            } else {
              // Navigate within a repository
              const path = args[0];
              const contents = await fetchGitHubContents(currentRepo, path);
              if (!contents) return `cd: ${path}: No such file or directory`;
              currentPath = path;
              return `Switched to directory: ${path}`;
            }

          case 'python':
            if (!args[0]) return 'Usage: python <script_path>';
            const scriptPath = args[0];
            const fileResponse = await fetch(`${baseURL}/${username}/${currentRepo}/contents/${scriptPath}`);
            if (!fileResponse.ok) return `python: ${scriptPath}: No such file or directory`;
            const fileData = await fileResponse.json();
            const scriptContent = atob(fileData.content);
            try {
              return await pyodide.runPythonAsync(scriptContent);
            } catch (err) {
              return `Python Error: ${err}`;
            }

          default:
            return `${cmd}: command not found`;
        }
      }

      // Handle user input
      input.addEventListener('keydown', async (event) => {
        if (event.key === 'Enter') {
          const command = input.value.trim();
          if (!command) return;

          // Display the command
          const commandOutput = document.createElement('div');
          commandOutput.className = 'output';
          commandOutput.textContent = `user@github:${currentPath || '~'}$ ${command}`;
          terminal.insertBefore(commandOutput, terminal.querySelector('.terminal-input'));

          input.value = '';

          // Execute the command and display the result
          const resultOutput = document.createElement('div');
          resultOutput.className = 'output';
          try {
            resultOutput.textContent = await executeCommand(command);
          } catch (err) {
            resultOutput.textContent = `Error: ${err}`;
            resultOutput.className += ' error';
          }

          if (resultOutput.textContent) {
            terminal.insertBefore(resultOutput, terminal.querySelector('.terminal-input'));
          }
          terminal.scrollTop = terminal.scrollHeight; // Scroll to the bottom
        }
      });
    }
    main();
  </script>
</body>
</html>
